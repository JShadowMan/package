Go - Web
--------

Go的`net/http`包提供了基础的路由函数组合与丰富的功能函数。根据经验，如果一个系统只要路由带有参数，并且这个项目的API数量超过10个，就尽量不要使用`net/http`了。


### 请求路由

在Web框架中，路由器是必备的组件。在Go圈子里路由器也经常被称为HTTP多路复用器（Mux, Multiplexer）。

目前开源社区中的Web框架大多使用`httprouter`（现在应该是`mux`比较热门），或是基于httprouter的变种对路由进行支持。

#### httprouter

httprouter中使用的是显式匹配，所以在设计路由时需要规避一些会导致路由冲突的情况。还有一点需要注意，因为httprouter考虑到字典树的深度，在初始化时会对参数的数量进行限制（路由中的参数数目不能超过255，否则会导致httprouter无法识别后续的参数）。

除了正常情况下的路由支持，httprouter也支持对一些特殊情况进行注册回调函数（如出现404错误时，或者内部出现panic时）。

#### 路由实现的原理

httprouter与众多衍生路由库使用的数据库结构被称为压缩动态检索树。所谓“压缩”指的是一个节点中不只存储一个字母，而是存储一整路径。使用压缩检索树可以减少树的层数，同时因为每个节点的数据存储也要比普通的检索树要多，程序的局部性较好（加载一个节点就可以进行多个字符串的比较），从而对CPU缓存友好。

#### 压缩检索树的创建过程

1. 一般情况下，每种Http方法都对应一颗独立的压缩检索树，这些树之间不共享数据。
2. 将注册的路由根据每段路径的类型构造成节点插入到树中。
3. 处理在插入节点过程中可能会出现树的分裂情况（/a/b/c /a/c/d）
4. 处理在插入节点过程中出现的冲突问题（/a/:id/name /a/:name/age）


### 中间件
